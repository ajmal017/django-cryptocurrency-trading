{% extends 'theme/base-site.html' %}
{% load i18n %}
{% load static %}

{% block title %}Dashboard | Received Offers{% endblock %}

{% block page-inner %}
<div class="page__inner dashboard">
    <header class="content-header">
        <h1 class="content-header__heading">Dashboard</h1>
        <div class="status">
            <div class="status__data"><span class="status__text">{{ user.customer.balance }} in wallet</span><a class="status__text" href="{{ them_url }}/my-balance">View Full Wallet</a></div>
			<div class="status__userpic"><img class="status__user-img" src="{% if user.avatar %}{{ user.avatar.file.url }}{% else %}{% static 'theme/images/userpic.png' %}{% endif %}" alt="{{ user }}"></div>
        </div>
    </header>
    <ul class="dashboard__page-nav page-nav">
        <li class="page-nav__item"><a class="page-nav__link" href="{{ theme_url }}/profile-overview">Profile Overview</a></li>
        <li class="page-nav__item is-selected"><a class="page-nav__link" href="{{ theme_url }}/received-offers">Received Offers</a></li>
        <li class="page-nav__item"><a class="page-nav__link" href="{{ theme_url }}/buy-sell-coins">Buy / Sell Coins</a></li>
        <li class="page-nav__item"><a class="page-nav__link" href="{{ theme_url }}/funding">Funding</a></li>
    </ul>
    <section class="dashboard__offers">
        {% for item in items %}
        <div class="dashboard__offer received-offer {% if item.offer.is_expired %} is-expired{% endif %}" id="{{ item.id }}">
            <header class="received-offer__user-data">
                <h2 class="received-offer__data-heading">New Bid</h2>
                <div class="received-offer__data-container">
                    <div class="received-offer__data">
                        <div class="received-offer__userpic"><img class="received-offer__user-img" src="{% if user.avatar %}{{ user.avatar.file.url }}{% else %}{% static 'theme/images/userpic.png' %}{% endif %}" alt=""></div>
                        <div>
                            <p class="received-offer__name">{{ item.created_by }}</p>
                            <p class="received-offer__score">{{ item.created_by.customer_rate }} Feedback Score</p>
                        </div>
                    </div>
                    <ul class="received-offer__list">
                        <li class="received-offer__item">{{ item.created_by.user.supported_language }}<svg class="received-offer__icon">
                                <use xlink:href="{% static 'theme/images/icons.svg' %}#check-circle"></use>
                            </svg></li>
                        <li class="received-offer__item">{{ item.created_by.user.email_verified|yesno:'Email Verified,Email Not Verified' }}<svg class="received-offer__icon">
                                <use xlink:href="{% static 'theme/images/icons.svg' %}#check-circle"></use>
                            </svg></li>
                        <li class="received-offer__item">{{ item.created_by.user.phone_verified|yesno:'SMS Verified,SMS Not Verified' }}<svg class="received-offer__icon">
                                <use xlink:href="{% static 'theme/images/icons.svg' %}#check-circle"></use>
                            </svg></li>
                        <li class="received-offer__item received-offer__item--successful">{{ item.created_by.successful_trade_count }} Successful Trades<svg class="received-offer__icon">
                                <use xlink:href="{% static 'theme/images/icons.svg' %}#check-circle"></use>
                            </svg></li>
                        <li class="received-offer__item received-offer__item--unsuccessful">{{ item.created_by.unsuccessful_trade_count }} Unsucessfull Trades<svg class="received-offer__icon">
                                <use xlink:href="{% static 'theme/images/icons.svg' %}#times-circle"></use>
                            </svg></li>
                        <li class="received-offer__item received-offer__item--score">Feedback score - {{ item.created_by.customer_rate }}/5<svg class="received-offer__icon">
                                <use xlink:href="{% static 'theme/images/icons.svg' %}#check-circle"></use>
                            </svg></li>
                    </ul>
                    <div class="received-offer__bottom">
                        {% if item.created_by.user.username == user.username and item.status == 'accepted' %}
                        <button class="received-offer__btn btn btn--theme-1" type="button" onclick="location.href='{{ theme_url }}/initiate-trade?item_id={{ item.offer.id }}'">COUNTER OFFER</button>
                        {% else %}
                        <button class="received-offer__btn btn btn--theme-2" onclick="postAction({'item_id': '{{item.id}}', 'mode': 'accepted'}, 'Are you sure to accept this offer?', '{{ theme_url }}/received-offers/', function(message) {location.href='{{ theme_url }}/initiate-trade?item_id={{ item.offer.id }}'});">ACCEPT</button>
                        <button class="received-offer__btn btn btn--theme-4" type="button" onclick="postAction({'item_id': '{{item.id}}', 'mode': 'declined'}, 'Are you sure to decline this offer?', '{{ theme_url }}/received-offers/', function(message) {$('#{{ item.id }}').remove()});">DECLINE</button>
                        {% endif %}
                    </div>
                </div>
            </header>
            <div class="received-offer__body">
                <header class="received-offer__inner">
                    <p class="received-offer__desc">{{ item.created_by }} offered {{ item.price }} {{ item.flat }} for {{ item.offer.get_trade_price }} {{ item.offer.flat }} / {{ item.offer.what_crypto }}</p>
                </header>
                <div class="received-offer__text">
                    {{ item.message|safe }}
                </div>
            </div>
        </div>
        {% endfor %}
        <button class="dashboard__load" type="button" onclick="this.nextElementSibling.classList.add('is-active'); this.style.display = 'none';">LOAD MORE</button>
        <div class="dashboard__loader loader">
            <div class="lds-css ng-scope">
                <div class="lds-spinner" style="width: 100%; height: 100%">
                    <div></div>
                </div>
            </div><span class="loader__text">LOADING</span>
        </div>
    </section>
</div>
{% endblock %}